<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>GeoPort Map</title>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        body { margin:0; height:100vh; display:flex; flex-direction:column; }
        #map { flex:1; }
        button { padding:12px; font-size:16px; }
    </style>
</head>

<body>

<div id="map"></div>
<button onclick="sendLocation()">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>

<script>
    const tg = window.Telegram.WebApp;

    // üî•üî•üî• –ë–ï–ó –≠–¢–û–ì–û iOS –ù–ï –†–ê–ë–û–¢–ê–ï–¢
    tg.ready();
    tg.expand();

    alert("WebApp READY");

    let lat = 55.7558;
    let lon = 37.6173;

    const map = L.map('map').setView([lat, lon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let marker = L.marker([lat, lon]).addTo(map);

    map.on('click', e => {
        lat = e.latlng.lat;
        lon = e.latlng.lng;
        marker.setLatLng([lat, lon]);
    });

    function sendLocation() {
        const data = {
            action: "set_location",
            lat: lat,
            lon: lon
        };

        alert("sendData()");
        tg.sendData(JSON.stringify(data));
        alert("sent");
    }
</script>

</body>
</html>
